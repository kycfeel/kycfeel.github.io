---
layout: post
title:  "MAAS를 통해 베어메탈로 클라우드 코스프레 하기"
date:   2017-12-24 11:05:45 +0900
categories: System Engineering
---

상당수 기업들의 서비스 환경이 AWS 등의 퍼블릭 클라우드로 대체되었지만, 아직까지 그 기업만의 물리적 환경을 고수하는 곳도 많이 존재하고, 또 여러가지 사정으로 어쩔 수 없이 물리적 환경을 유지할 수 밖에 없는 기업들도 잔뜩 남아있다. 만약 당신이 물리적 인프라를 만져야 한다고 해도, 너무 걱정하지는 말자. 요즘은 더 이상 물리 환경에서도 가상화 환경이 안겨주는 유연함과 중앙 관리의 용이성을 포기할 필요가 없어졌다.

전통적인 물리적 인프라를 조금이라도 더 덜 골치아프고 강력하게 사용할 수 있는 방법은 지금도 전 세계에서 연구되고 있고, 그 중 몇년 전부터 캐노니컬에서 자사의 우분투를 통해 밀어주고 있는 [MAAS](https://maas.io) 라는 솔루션이 버프를 잔뜩 받으며 유명해지고 있다. 하기야 우분투 서버의 최초 설치 화면에 대놓고 MAAS 환경을 구축하는 메뉴가 있으니 유명해지는 건 어떻게 보면 당연하지만, 솔루션 자체도 훌륭하니 뭐 상관 없을지도 모르겠다.

이름부터 'Metal-as-a-Service'인 MAAS를 통해, 우리의 골치아픈 베어메탈에 멋진 클라우드 옷을 입혀보는 건 어떨까.

설치?
=========

위에서 잠깐 언급했듯, 최신 우분투 서버 이미지는 대놓고 최초 설치 화면부터 MAAS 환경을 구축하는 옵션을 제공한다. 작성일 기준 최신 LTS 이미지인 우분투 서버 16.04.3 이미지에는 아래와 같이 존재하고 있다.

<div align="center"><img src="https://github.com/kycfeel/kycfeel.github.io/blob/master/_images/maas-install.png?raw=true"/></div><br/>

> 혹시 이전 버전이나 이후 버전으로 설치를 시도할 경우, 옵션의 명칭이 이미지와 다를 수 있다. 14.04 LTS 버전의 경우 Region 컨트롤러와 Rack 컨트롤러로 구분되지 않고 단 하나의 MAAS 설치 메뉴만 존재했던 것으로 기억한다. 추후에도 얼마든지 바뀔 수 있으니 참고 바란다.

여기서 잠깐. Region 컨트롤러는 무엇이고, Rack 컨트롤러는 또 뭘까?

일단, Region 컨트롤러는 MAAS 환경의 뿌리 그 자체이다. 한 지역의 MAAS 환경은 여기서부터 시작되며, 웹 UI나 DNS, DB(PostgreSQL) 서비스, 사용되는 REST API 서버 등은 이 Region 컨트롤러가 담당하는 영역이다.

Rack 컨트롤러의 Rack은 우리가 아는 그 데이터센터의 랙이다. HTTP, TFTP를 통한 부팅 이미지 다운로드 / 관리 노드로의 이미지 전송, DHCP, iSCSI 서비스, 관리 노드의 전원 관리 등의 역할을 담당한다. 기본적으로 Region 컨트롤러도 Rack 컨트롤러의 기능까지 수행할 수 있지만, 캐노니컬은 일반적으로 서버랙 하나당 하나의 Rack 컨트롤러를 위치시키는 것을 권장하고 있다. 적당히 배치한 Rack 컨트롤러는 MAAS 환경의 전체적인 성능과 안정성을 높혀주니 잘 생각해서 배치하자.

MAAS 환경의 구성 요소에 대한 자세한 설명은 [이 곳](https://docs.ubuntu.com/maas/2.2/en/intro-concepts#controllers)에서 확인할 수 있다. 당연하지만 고가용성(HA) 구성도 공식적으로 지원하니 [이 문서](https://docs.ubuntu.com/maas/2.2/en/manage-ha)를 읽어볼 것.

이 포스트에서는 최소한의 구성과 설정으로 MAAS 환경의 맛을 보는 것을 목적으로 하니 일단 Region 컨트롤러 하나만 설치해보자. 필자처럼 VirtualBox 등의 가상화 하이퍼바이저를 사용해도 좋고, 여유가 있다면 실제 물리 환경에서 설치해봐도 좋다.

설치 과정의 대부분은 시스템이 자동으로 처리하며, 중간중간 안내창을 따라 계정 생성이나 다중 네트워크 환경일 경우 메인으로 사용할 NIC 정도만 지정해주면 된다.

설치가 완료되었다면, 이제 웹 브라우저에서 해당 Region 컨트롤러 IP + 포트 5240으로 접속해 보자. 깔끔한 디자인의 웹 콘솔이 반겨줄 것이다.

이제 뿌리가 갖춰졌으니, 직접 노드를 추가해볼 차례다. 필자는 아래와 같은 테스트 환경을 구성했다. 방금 설치된 컨트롤러에 `node1`과 `node2`를 연결하고, 각각 `admin` 계정과 `user` 계정에 노드를 하나씩 할당한 후, Ubuntu 16.04 LTS 버전을 PXE와 TFTP를 통해 설치할 것이다. 독자는 본인의 상황에 맞게 필요한 부분만 긁어가도 된다.
